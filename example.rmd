---
title: "Example of using the simulator"
output: html_document
date: "2023-10-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(plotly)
```

## Capacity fractions example

```{r}
source("capacity_fractions.R")
```

```{r}
create_capacity_fractions_netbewust_laden(as_datetime("2023-01-01"), as_datetime("2024-01-01")) %>%
  filter(date_time >= "2023-01-01", date_time <= "2023-01-08") %>%
  {plot_ly(x=.$date_time, y=.$value)}
```

## Model example

```{r}
source("model.R")
```

```{r}
sessions_path = "data/Input/Den Haag/sessions.rds"
sessions <- readRDS(sessions_path)
sessions_week <- get_sessions_week(sessions, "Charging Station")
```

```{r}
results <- simulate(
  sessions,
  sessions_week,
  profile_type = "Charging Station",
  regular_profile = FALSE,
)
```

```{r}
results$individual %>%
  filter(run_id == 1) %>%
  filter(n > 0)
```

```{r}
results$individual %>%
  filter(run_id==1) %>%
  {plot_ly(x=.$date_time, y=.$power)}
```
