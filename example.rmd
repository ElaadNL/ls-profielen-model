---
title: "Example of using the simulator"
output: html_document
date: "2023-10-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(plotly)
```

## Capacity fractions example

```{r}
source("capacity_fractions.R")
```

```{r}
create_capacity_fractions_netbewust_laden(as_datetime("2023-01-01"), as_datetime("2024-01-01"), times=list(
  list(floor_start=17, floor_end=23, pre_slope=1, post_slope=7),
  list(floor_start=7, floor_end=9, pre_slope=NULL, post_slope=NULL)
  )) %>%
  filter(date_time >= "2023-01-01", date_time <= "2023-01-08") %>%
  {plot_ly(x=.$date_time, y=.$value)}
```

## Model example

```{r}
source("model.R")
```

```{r}
sessions_path = "data/Input/Den Haag/sessions.rds"
sessions <- readRDS(sessions_path)
sessions_week <- get_sessions_week(sessions, "Charging Station")
```

```{r}
source("model.R")

results <- simulate(
  sessions,
  sessions_week,
  n_runs=30,
  profile_type = "Charging Station",
  regular_profile = FALSE,
)
```

```{r}
results$individual %>%
  filter(run_id == 1) %>%
  filter(n > 0)
```

```{r}
results$individual %>%
  filter(run_id==2) %>%
  filter(date_time > "2022-10-01", date_time < "2022-12-01", power > 0) %>%
  {plot_ly(x=.$date_time, y=.$power, color=.$n)}
```
